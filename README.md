# scp 实现文件加密传输

## 实现原理

- 共享密钥是服务端、客户端双方约定的，服务端和客户端都持有。它不会被传输，不能泄露，用于交换非对称加密的公钥，确保服务端、客户端交换公钥的安全。
- 非对称加密公私密钥，服务端、客户端各有一份，临时生成的，用于交换对称密钥。
- 对称密钥，服务端临时生成的，用客户端公钥加密后下发给客户端，用于加密文件。

## 具体流程如下

1. 服务端启动，并生成非对称加密公私密钥
2. 客户端启动，并生成非对称加密公私密钥
3. 客户端请求服务端公钥，服务端用共享密钥签名后下发服务端公钥
4. 客户端用共享密钥签名方式验证服务端公钥
5. 客户端用共享密钥签名+服务端公钥加密的方式上传客户端公钥
6. 服务端用共享密钥签名方式验证客户端公钥的密文，并用服务端私钥解密客户端公钥
7. 客户端请求服务端对称加密密钥
8. 服务端用客户端公钥加密对称密钥后下发给客户端
9. 客户端开始遍历目标目录，并读取文件，用对称加密的方式上传到服务端
10. 服务端用对称密钥解密文件，并保存到指定目录

## 运行环境

- php 8.0以上
- 安装openssl扩展
- 正确配置环境变量`OPENSSL_CONF=C:\server\apache\conf\openssl.cnf`